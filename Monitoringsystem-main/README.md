# -情绪健康监测系统
基于表情与语音的学生健康监测系统，用于完成课程项目开发  test
### 1、情绪识别测试录制网站部分代码介绍
本部分由 ziyou 完成基本框架。
#### 1.1、实际使用方式
运行server.py启动服务器，然后在浏览器上访问 http://127.0.0.1:5000 即可（目前没有云端的妥协方案，后续考虑部署至云端）。\
用户可以点击开始录制按钮开始录制，点击结束录制按钮结束录制，录制结果会被分片为若干mp4文件并存至 uploads 文件夹；\
用户也可以直接上传已经录制好的文件，以这种方式上传的文件也会存在 uploads 文件夹以供模型读取，这种方式不会切片；\
PS：由于直接录制演示比较困难，课题演示主要以上传已经录制好的文件为主。
#### 1.2、进一步开发手册
server.py中有main主函数，网站主线程在此运行，如需添加功能，需建立线程B。
##### 1.2.1、如何向客户端发送消息：
在你的线程B中调用 push_message(message, color) 函数；\
其有两个参数，message是十六进制的字符串类型，表示文本信息，会完整显示在网页的服务器返回数据侧框中，推荐格式为 f'[情绪识别数据返回]xxxxx' ，不要漏了f；\
color是字符串类型，是想显示的颜色的十六进制RBG代码，如 '#87CEEB' 为天蓝色，情绪识别数据返回的文本颜色推荐为天蓝色；\
完整使用案例：push_message(f'视频切片 {filename} 上传成功!', '#006400')  # 绿色，表示成功\
如果你需要测试发送功能，可以取消main函数中被注释掉的input_thread进程，这个进程会运行handle_user_input()，用以将你在服务器终端输入的文本作为文本参数去调用 push_message(message, color) 函数，向客户端发送信息；\
你也可以仿照input_thread进程的设计方式设计你的进程B；
##### 1.2.2、如何修改切片时长：
目前测试网站的切片规则是：每1分钟进行一次切片，未满1分钟的也自成1个切片，如2分20秒的录制会被切成2个1分钟切片和1个20秒切片（注意，直接上传文件则不会切片）；\
由于切片时长对模型识别结果和用户体验有较大影响，时间太短模型识别存在困难，时间太长用户又缺失体验，所以需要不断调整寻找平衡。\
调整方式：index.html中存在函数 checkRecordingDuration() 用以检查时长，调整逻辑判断部分 elapsedTime >= 60 即可（单位：秒）。
